<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Calculadora de Calorías</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #0f172a;
      color: white;
      margin: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }
    .btn-calculadora {
      background: #00ffc0;
      color: #000;
      border: none;
      padding: 12px 24px;
      border-radius: 12px;
      font-weight: bold;
      cursor: pointer;
      transition: 0.3s;
    }
    .btn-calculadora:hover { background: #00e6b8; transform: scale(1.05); }

    #calorie-modal {
      display: none;
      justify-content: center;
      align-items: center;
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(6px);
      z-index: 9999;
    }
    #calorie-modal .modal-content {
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(12px);
      border-radius: 20px;
      padding: 25px;
      width: 90%;
      max-width: 450px;
      box-shadow: 0 8px 25px rgba(0,0,0,0.3);
      border: 2px solid transparent;
      background-clip: padding-box;
      position: relative;
    }
    #calorie-modal .modal-content::before {
      content: "";
      position: absolute;
      inset: 0;
      border-radius: 20px;
      padding: 2px;
      background: linear-gradient(135deg, #00bfff, #ff7eb3, #ffe259);
      -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
      -webkit-mask-composite: destination-out;
      mask-composite: exclude;
      z-index: -1;
    }
    #calorie-modal .close {
      position: absolute;
      top: 12px;
      right: 15px;
      font-size: 20px;
      cursor: pointer;
      color: white;
      background: rgba(0,0,0,0.3);
      border-radius: 50%;
      padding: 5px 10px;
    }
    #calorie-modal input, #calorie-modal select {
      width: 100%;
      padding: 10px;
      margin: 8px 0;
      border-radius: 12px;
      border: none;
      outline: none;
      background: rgba(255, 255, 255, 0.2);
      color: white;
      font-weight: 500;
    }
    .error-message { color:#ff4d4d; font-size:0.9rem; margin-top:4px; }
    input.error, select.error {
      border: 2px solid #ff4d4d !important;
      box-shadow: 0 0 10px rgba(255, 77, 77, 0.6);
    }
    #resultado {
      font-weight: bold;
      text-align: center;
      margin-top: 10px;
    }
    #toggleChartMode {
      background: rgba(255,255,255,0.2);
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 10px;
      margin-top: 10px;
      cursor: pointer;
    }
  </style>
</head>
<body>

  <!-- Botón que abre la calculadora -->
  <button onclick="abrirCalculadora()" class="btn-calculadora">
    Abrir Calculadora de Calorías
  </button>

  <!-- Modal de la calculadora -->
  <div id="calorie-modal">
    <div class="modal-content">
      <span class="close" onclick="cerrarCalculadora()">✖</span>
      <h2 style="text-align:center;color:white;">Calculadora de Calorías</h2>
      <form id="calorie-form">
        <input type="number" id="peso" placeholder="Peso (kg)" required>
        <input type="number" id="altura" placeholder="Altura (cm)" required>
        <input type="number" id="edad" placeholder="Edad" required>
        <select id="sexo" required>
          <option value="">Sexo</option>
          <option value="M">Hombre</option>
          <option value="F">Mujer</option>
        </select>
        <select id="actividad" required>
          <option value="">Nivel de actividad</option>
          <option value="1.2">Sedentario</option>
          <option value="1.375">Ligero</option>
          <option value="1.55">Moderado</option>
          <option value="1.725">Activo</option>
          <option value="1.9">Muy Activo</option>
        </select>
        <select id="objetivo" required>
          <option value="cut">Pérdida de peso</option>
          <option value="maintain">Mantenimiento</option>
          <option value="bulk">Volumen</option>
        </select>
        <button type="submit">Calcular</button>
      </form>
      <p id="resultado"></p>
      <canvas id="macroChart" width="300" height="300"></canvas>
      <button type="button" id="toggleChartMode">Ver en gramos</button>
      <p id="resumen-macros"></p>
    </div>
  </div>

  <script>
    function abrirCalculadora(){document.getElementById("calorie-modal").style.display="flex";}
    function cerrarCalculadora(){document.getElementById("calorie-modal").style.display="none";}

    const form=document.getElementById("calorie-form");
    const resultado=document.getElementById("resultado");
    const resumenMacros=document.getElementById("resumen-macros");
    let chart,mostrarEnGramos=false;

    form.addEventListener("submit",e=>{
      e.preventDefault();
      document.querySelectorAll(".error-message").forEach(el=>el.remove());
      document.querySelectorAll("#calorie-form input,#calorie-form select").forEach(el=>el.classList.remove("error"));
      let valido=true;
      function marcarError(campo,msg){
        campo.classList.add("error");
        const m=document.createElement("div");
        m.className="error-message"; m.textContent=msg;
        campo.insertAdjacentElement("afterend",m); valido=false;
      }
      const peso=parseFloat(document.getElementById("peso").value);
      const altura=parseFloat(document.getElementById("altura").value);
      const edad=parseInt(document.getElementById("edad").value);
      const sexo=document.getElementById("sexo");
      const actividad=document.getElementById("actividad");
      const objetivo=document.getElementById("objetivo");
      if(isNaN(peso)||peso<30||peso>300)marcarError(document.getElementById("peso"),"Peso inválido (30-300 kg)");
      if(isNaN(altura)||altura<100||altura>250)marcarError(document.getElementById("altura"),"Altura inválida (100-250 cm)");
      if(isNaN(edad)||edad<10||edad>100)marcarError(document.getElementById("edad"),"Edad inválida (10-100 años)");
      if(!sexo.value)marcarError(sexo,"Selecciona tu sexo");
      if(!actividad.value)marcarError(actividad,"Selecciona tu actividad");
      if(!objetivo.value)marcarError(objetivo,"Selecciona tu objetivo");
      if(!valido){resultado.textContent="⚠️ Revisa los campos resaltados."; return;}
      let bmr=sexo.value==="M"?10*peso+6.25*altura-5*edad+5:10*peso+6.25*altura-5*edad-161;
      let tdee=bmr*parseFloat(actividad.value);
      if(objetivo.value==="cut")tdee-=500;
      if(objetivo.value==="bulk")tdee+=300;
      resultado.textContent=`Necesitas aproximadamente ${Math.round(tdee)} kcal/día.`;
      const macros={carbs:tdee*0.4,protein:tdee*0.3,fat:tdee*0.3};
      actualizarGrafico(macros);
    });

    function actualizarGrafico(macros){
      const ctx=document.getElementById("macroChart").getContext("2d");
      const data={labels:["Carbohidratos","Proteínas","Grasas"],datasets:[{data:[
        mostrarEnGramos?macros.carbs/4:macros.carbs,
        mostrarEnGramos?macros.protein/4:macros.protein,
        mostrarEnGramos?macros.fat/9:macros.fat
      ],backgroundColor:["#00bfff","#ff7eb3","#ffe259"],borderWidth:2,borderColor:"rgba(255,255,255,0.8)"}]};
      const options={responsive:true,plugins:{legend:{labels:{color:"white"}},tooltip:{callbacks:{label:ctx=>mostrarEnGramos?`${ctx.label}: ${ctx.formattedValue} g`:`${ctx.label}: ${ctx.formattedValue} kcal`}}}};
      if(chart){chart.data=data; chart.update();}
      else{chart=new Chart(ctx,{type:"doughnut",data,options});}
      resumenMacros.textContent=mostrarEnGramos?`Carbs: ${(macros.carbs/4).toFixed(0)}g | Prot: ${(macros.protein/4).toFixed(0)}g | Grasas: ${(macros.fat/9).toFixed(0)}g`:`Carbs: ${macros.carbs.toFixed(0)} kcal | Prot: ${macros.protein.toFixed(0)} kcal | Grasas: ${macros.fat.toFixed(0)} kcal`;
    }

    document.getElementById("toggleChartMode").addEventListener("click",()=>{
      mostrarEnGramos=!mostrarEnGramos;
      document.getElementById("toggleChartMode").textContent=mostrarEnGramos?"Ver en kcal":"Ver en gramos";
      form.dispatchEvent(new Event("submit"));
    });
  </script>
</body>
</html>
