<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Chat Mejorado - Gerard Valls</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #011627;
    color: #a0e9d8;
    margin: 0; padding: 0;
    display: flex;
    flex-direction: column;
    height: 100vh;
  }
  header {
    background: #00ffc8;
    color: #003333;
    padding: 1rem;
    text-align: center;
    font-weight: bold;
    font-size: 1.5rem;
  }
  main {
    flex: 1;
    display: flex;
    flex-direction: column;
    padding: 1rem;
    overflow: hidden;
  }
  #chatbot-messages {
    flex: 1;
    overflow-y: auto;
    padding-right: 0.5rem;
    margin-bottom: 1rem;
  }
  .message {
    margin-bottom: 1rem;
    max-width: 70%;
    padding: 0.6rem 1rem;
    border-radius: 20px;
    word-wrap: break-word;
  }
  .bot-message {
    background: #00ffc8;
    color: #003333;
    align-self: flex-start;
  }
  .user-message {
    background: #011627;
    border: 2px solid #00ffc8;
    color: #a0e9d8;
    align-self: flex-end;
  }
  #typing-indicator {
    font-style: italic;
    font-size: 0.9rem;
    color: #00ffc8;
    margin-bottom: 0.8rem;
    min-height: 1.2rem;
  }
  form {
    display: flex;
    gap: 0.5rem;
  }
  input[type="text"] {
    flex: 1;
    padding: 0.8rem 1rem;
    border-radius: 20px;
    border: none;
    outline: none;
    font-size: 1rem;
    background: #022b38;
    color: #a0e9d8;
  }
  button {
    padding: 0 1.2rem;
    background: #00ffc8;
    border: none;
    border-radius: 20px;
    color: #003333;
    font-weight: bold;
    cursor: pointer;
    transition: background-color 0.2s ease;
  }
  button:hover {
    background: #00e6b8;
  }
  /* Quick reply buttons container */
  .quick-replies {
    display: flex;
    gap: 8px;
    margin-top: 0.5rem;
    flex-wrap: wrap;
  }
  .quick-replies button {
    padding: 6px 14px;
    font-weight: 600;
    background-color: #00ffc8;
    color: #003333;
    border: none;
    border-radius: 20px;
    cursor: pointer;
    transition: background-color 0.2s ease;
  }
  .quick-replies button:hover {
    background-color: #00e6b8;
  }
  a {
    color: #a0e9d8;
    text-decoration: underline;
  }
</style>
</head>
<body>
<header>Chat Nutricional con Gerard Valls</header>
<main>
  <div id="chatbot-messages"></div>
  <div id="typing-indicator"></div>
  <form id="chat-form">
    <input type="text" id="user-input" placeholder="Escribe tu mensaje..." autocomplete="off" />
    <button type="submit">Enviar</button>
  </form>
</main>

<script>
  const chatForm = document.getElementById('chat-form');
  const userInput = document.getElementById('user-input');
  const chatbotMessages = document.getElementById('chatbot-messages');
  const typingIndicator = document.getElementById('typing-indicator');

  function scrollToBottom() {
    chatbotMessages.scrollTop = chatbotMessages.scrollHeight;
  }

  function addBotMessage(text) {
    const message = document.createElement('div');
    message.classList.add('message', 'bot-message');
    message.innerHTML = text;
    chatbotMessages.appendChild(message);
    scrollToBottom();
  }

  function addUserMessage(text) {
    const message = document.createElement('div');
    message.classList.add('message', 'user-message');
    message.textContent = text;
    chatbotMessages.appendChild(message);
    scrollToBottom();
  }

  function toggleTyping(isTyping) {
    typingIndicator.textContent = isTyping ? 'Gerard está escribiendo...' : '';
  }

  function addQuickReplies(replies = []) {
    if (!replies.length) return;

    const container = document.createElement('div');
    container.classList.add('quick-replies');

    replies.forEach(text => {
      const btn = document.createElement('button');
      btn.textContent = text;

      btn.onclick = () => {
        addUserMessage(text);
        botResponse(text);
        container.remove();
      };

      container.appendChild(btn);
    });

    chatbotMessages.appendChild(container);
    scrollToBottom();
  }

  function botResponse(message) {
    toggleTyping(true);
    const delay = 800 + Math.random() * 1200;

    setTimeout(() => {
      const msg = message.toLowerCase();
      toggleTyping(false);

      if (msg.includes('hola') || msg.includes('buenos')) {
        addBotMessage("¡Hola! ¿Quieres saber sobre planes de alimentación o asesoría?");
        addQuickReplies(['Planes de alimentación', 'Asesoría personalizada', 'Contacto']);
      } else if (msg.includes('plan') || msg.includes('alimentación')) {
        addBotMessage("Ofrezco planes personalizados según tu objetivo y actividad física.");
        addQuickReplies(['Perder peso', 'Ganar músculo', 'Volver']);
      } else if (msg.includes('peso') || msg.includes('adelgazar')) {
        addBotMessage("Puedo ayudarte a perder peso con un plan saludable y sostenible.");
        addQuickReplies(['¿Cómo empiezo?', '¿Qué comer?', 'Volver']);
      } else if (msg.includes('contacto')) {
        addBotMessage(`Puedes contactarme por email: <a href="mailto:gerardvalls@gmail.com">gerardvalls@gmail.com</a> o WhatsApp: <a href="https://wa.me/34612345678" target="_blank" rel="noopener">+34 612 345 678</a>`);
        addQuickReplies(['Volver']);
      } else if (msg === 'volver') {
        addBotMessage("¿En qué más puedo ayudarte?");
        addQuickReplies(['Planes de alimentación', 'Asesoría personalizada', 'Contacto']);
      } else if (msg.includes('cómo empiezo')) {
        addBotMessage("Para comenzar, dime tus hábitos actuales y metas específicas.");
        addQuickReplies(['Quiero bajar 5 kg', 'Quiero estar más saludable', 'Volver']);
      } else if (msg.includes('qué comer')) {
        addBotMessage("Te puedo sugerir una dieta balanceada rica en frutas, verduras y proteínas magras.");
        addQuickReplies(['Más info', 'Volver']);
      } else if (msg.includes('más info')) {
        addBotMessage("Claro, puedo enviarte una guía completa si quieres. ¿Quieres que te la envíe?");
        addQuickReplies(['Sí, por favor', 'No, gracias', 'Volver']);
      } else if (msg.includes('sí') || msg.includes('por favor')) {
        addBotMessage("¡Perfecto! Te enviaré el material a tu email: gerardvalls@gmail.com");
        addQuickReplies(['Volver']);
      } else if (msg.includes('no')) {
        addBotMessage("Está bien, dime si necesitas ayuda con algo más.");
        addQuickReplies(['Planes de alimentación', 'Asesoría personalizada', 'Contacto']);
      } else {
        addBotMessage("Disculpa, no entiendo tu pregunta. Por favor intenta con otra.");
        addQuickReplies(['Planes de alimentación', 'Asesoría personalizada', 'Contacto']);
      }
    }, delay);
  }

  chatForm.addEventListener('submit', e => {
    e.preventDefault();
    const inputText = userInput.value.trim();
    if (!inputText) return;
    addUserMessage(inputText);
    botResponse(inputText);
    userInput.value = '';
  });

  // Saludo inicial
  addBotMessage("¡Hola! Soy Gerard, tu asistente nutricional. ¿En qué puedo ayudarte hoy?");
  addQuickReplies(['Planes de alimentación', 'Asesoría personalizada', 'Contacto']);
</script>
</body>
</html>
