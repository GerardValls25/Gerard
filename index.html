<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gerard Valls - Nutrición Profesional</title>

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">

  <!-- Font Awesome -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

  <!-- GSAP -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.13.0/gsap.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.13.0/ScrollTrigger.min.js" defer></script>

  <style>
    /* --- [TODO: PEGAR AQUÍ TODO TU BLOQUE DE ESTILOS (CSS) EXISTENTE] --- */
    /* Debido al límite de caracteres, aquí deberías pegar todo el bloque <style> que ya tenías definido en tu versión anterior. */
  </style>
</head>
<body>

<header>
  <h1>Gerard Valls</h1>
  <p>Nutrición personalizada para deportistas y personas activas</p>
  <button id="toggle-theme">Cambiar a modo claro</button>
</header>

<nav>
  <a href="#servicios">Servicios</a>
  <a href="#testimonios">Testimonios</a>
  <a href="#consulta">Formulario</a>
  <a href="calculadora.html" target="_blank">Calculadora</a>
  <a href="imc.html" target="_blank">IMC</a>
</nav>

<main class="wrapper">
  <!-- [SERVICIOS, BENEFICIOS, PLANES, TESTIMONIOS] -->
  <!-- [TODO: Pega aquí todo el contenido <section> que ya tenías definido, hasta llegar al formulario] -->

  <!-- FORMULARIO -->
  <section id="consulta" style="margin-top:60px; text-align:left; max-width:600px; margin-left:auto; margin-right:auto;">
    <h2>Consulta</h2>
    <form class="glass-form" action="https://formspree.io/f/your-form-id" method="POST">
      <div class="form-group"><input type="text" id="nombre" name="nombre" placeholder=" " required><label for="nombre"><i class="fas fa-user"></i> Nombre</label></div>
      <div class="form-group"><input type="email" id="email" name="_replyto" placeholder=" " required><label for="email"><i class="fas fa-envelope"></i> Email</label></div>
      <div class="form-group"><textarea id="mensaje" name="mensaje" rows="5" placeholder=" " required></textarea><label for="mensaje"><i class="fas fa-comment"></i> Mensaje</label></div>
      <button type="submit" style="width:100%;">Enviar</button>
      <div id="formMsg" style="text-align:center;margin-top:10px;font-weight:bold;"></div>
    </form>
  </section>
</main>

<!-- MODAL DE FORMULARIO -->
<div id="form-modal" style="
  display: none;
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: #fff;
  color: #333;
  padding: 30px 40px;
  border-radius: 20px;
  box-shadow: 0 20px 60px rgba(0,0,0,0.35);
  z-index: 9999;
  max-width: 90%;
  width: 320px;
  text-align: center;
  font-family: 'Montserrat', sans-serif;
">
  <div id="form-modal-icon" style="font-size: 3rem; margin-bottom: 16px;"></div>
  <p id="form-modal-msg" style="font-size: 1.2rem; font-weight: 600;"></p>
  <button onclick="closeFormModal()" style="
    margin-top: 24px;
    background: #007bb5;
    color: white;
    border: none;
    padding: 12px 28px;
    border-radius: 12px;
    cursor: pointer;
    font-weight: 600;
    text-transform: uppercase;
    font-size: 0.9rem;
  ">Cerrar</button>
</div>

<!-- BOTONES FIJOS -->
<button id="whatsapp-btn" aria-label="Contactar por WhatsApp"><i class="fab fa-whatsapp"></i></button>
<button id="scrollTopBtn" aria-label="Volver arriba"><i class="fas fa-arrow-up"></i></button>

<footer>&copy; 2025 Gerard Valls | Nutrición Profesional</footer>

<script>
  // Cambiar tema
  const toggleThemeBtn = document.getElementById('toggle-theme');
  toggleThemeBtn.addEventListener('click', () => {
    document.body.classList.toggle('light');
    toggleThemeBtn.textContent = document.body.classList.contains('light')
      ? 'Cambiar a modo oscuro'
      : 'Cambiar a modo claro';
  });

  // Scroll Top
  const scrollBtn = document.getElementById('scrollTopBtn');
  window.addEventListener('scroll', () => {
    scrollBtn.classList.toggle('show', window.scrollY > 300);
  });
  scrollBtn.addEventListener('click', () => window.scrollTo({ top: 0, behavior: 'smooth' }));

  // WhatsApp
  const whatsappBtn = document.getElementById('whatsapp-btn');
  whatsappBtn.addEventListener('click', () => window.open('https://wa.me/tu-numero-whatsapp', '_blank'));

  // GSAP Animaciones
  gsap.registerPlugin(ScrollTrigger);
  gsap.utils.toArray(".service, .pricing-card, #incluye-todos").forEach(elem => {
    gsap.from(elem, {
      scrollTrigger: { trigger: elem, start: "top 80%" },
      opacity: 0,
      y: 50,
      duration: 0.8,
      stagger: 0.2,
      ease: "power2.out"
    });
  });

  // Modal funciones
  function showFormModal(message, success = true) {
    const modal = document.getElementById('form-modal');
    const msg = document.getElementById('form-modal-msg');
    const icon = document.getElementById('form-modal-icon');

    msg.textContent = message;
    modal.style.background = success ? "#d4f6e8" : "#ffe3e3";
    msg.style.color = success ? "#004d40" : "#b71c1c";

    icon.innerHTML = success
      ? '<i class="fas fa-check-circle" style="color:#2e7d32;"></i>'
      : '<i class="fas fa-exclamation-triangle" style="color:#c62828;"></i>';

    modal.style.display = "block";
    gsap.fromTo(modal,
      { scale: 0.6, opacity: 0 },
      { scale: 1, opacity: 1, duration: 0.4, ease: "back.out(1.7)" }
    );

    clearTimeout(window.modalTimeout);
    window.modalTimeout = setTimeout(closeFormModal, 6000);
  }

  function closeFormModal() {
    const modal = document.getElementById('form-modal');
    gsap.to(modal, {
      scale: 0.6,
      opacity: 0,
      duration: 0.3,
      onComplete: () => modal.style.display = "none"
    });
  }

  // Formulario validación + envío
  const form = document.querySelector('.glass-form');
  form.addEventListener('submit', e => {
    e.preventDefault();

    const nombre = document.getElementById('nombre').value.trim();
    const email = document.getElementById('email').value.trim();
    const mensaje = document.getElementById('mensaje').value.trim();

    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

    if (nombre === "") {
      showFormModal("Por favor, ingresa tu nombre.", false);
      return;
    }

    if (!emailRegex.test(email)) {
      showFormModal("Por favor, ingresa un email válido.", false);
      return;
    }

    if (mensaje.length < 10) {
      showFormModal("El mensaje debe tener al menos 10 caracteres.", false);
      return;
    }

    fetch(form.action, {
      method: 'POST',
      body: new FormData(form),
      headers: { 'Accept': 'application/json' }
    })
    .then(res => {
      if (res.ok) {
        form.reset();
        showFormModal("Mensaje enviado con éxito. ¡Gracias por tu consulta!", true);
      } else {
        return res.json().then(data => {
          throw new Error(data.error || "Error al enviar el formulario.");
        });
      }
    })
    .catch(() => {
      showFormModal("Hubo un error al enviar. Intenta nuevamente más tarde.", false);
    });
  });
</script>
</body>
</html>
